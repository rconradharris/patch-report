#!/usr/bin/env python
"""
Refresh patch_report cache.

usage: refresh [--clear-cache]

--clear-cache will clear the cache so that issues can be refreshed

Intended to be run from a cron-job.
"""
import os
import sys

import patch_report

PIDFILE = '/tmp/refresh.pid'

if os.path.exists(PIDFILE):
    sys.exit(1)

with open(PIDFILE, 'w') as f:
    f.write(str(os.getpid()))

try:
    clear = '--clear-cache' in sys.argv[1:]
    patch_report.refresh_projects(clear=clear)
finally:
    os.unlink(PIDFILE)
